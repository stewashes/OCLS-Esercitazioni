from gurobipy import *

m = Model('Vehicle Allocation Model')

N = 4

T = 6
tau = 1

Nodes = ['1', '2', '3', '4']
time = [1, 2, 3, 4, 5, 6]
av = {}
link_day = {}

for i in Nodes:
    for t in time:
        av[i, t] = 0

av['1', 1] = 1
av['3', 2] = 1
av['4', 2] = 1

link_day, demands, p, c = multidict({
    ('1', '1', 1): [0, 0, 0],
    ('1', '2', 1): [0, 0, 0],
    ('1', '3', 1): [0, 0, 0],
    ('1', '4', 1): [1, 0.4 * 465, 0.5 * 465],

    ('2', '1', 1): [0, 0, 0],
    ('2', '2', 1): [0, 0, 0],
    ('2', '3', 1): [0, 0, 0],
    ('2', '4', 1): [0, 0, 0],

    ('3', '1', 1): [0, 0, 0],
    ('3', '2', 1): [0, 0, 0],
    ('3', '3', 1): [0, 0, 0],
    ('3', '4', 1): [0, 0, 0],

    ('4', '1', 1): [0, 0, 0],
    ('4', '2', 1): [0, 0, 0],
    ('4', '3', 1): [0, 0, 0],
    ('4', '4', 1): [0, 0, 0],

    ('1', '1', 2): [0, 0, 0],
    ('1', '2', 2): [0, 0, 0],
    ('1', '3', 2): [0, 0, 0],
    ('1', '4', 2): [0, 0, 0],

    ('2', '1', 2): [0, 0, 0],
    ('2', '2', 2): [0, 0, 0],
    ('2', '3', 2): [0, 0, 0],
    ('2', '4', 2): [0, 0, 0],

    ('3', '1', 2): [0, 0, 0],
    ('3', '2', 2): [2, 0.4 * 465, 0.5 * 465],
    ('3', '3', 2): [0, 0, 0],
    ('3', '4', 2): [0, 0, 0],

    ('4', '1', 2): [1, 0.4 * 465, 0.5 * 465],
    ('4', '2', 2): [0, 0, 0],
    ('4', '3', 2): [0, 0, 0],
    ('4', '4', 2): [0, 0, 0],

    ('1', '1', 3): [0, 0, 0],
    ('1', '2', 3): [0, 0, 0],
    ('1', '3', 3): [0, 0, 0],
    ('1', '4', 3): [0, 0, 0],

    ('2', '1', 3): [0, 0, 0],
    ('2', '2', 3): [0, 0, 0],
    ('2', '3', 3): [0, 0, 0],
    ('2', '4', 3): [2, 0.4 * 480, 0.5 * 480],

    ('3', '1', 3): [0, 0, 0],
    ('3', '2', 3): [0, 0, 0],
    ('3', '3', 3): [0, 0, 0],
    ('3', '4', 3): [0, 0, 0],

    ('4', '1', 3): [0, 0, 0],
    ('4', '2', 3): [0, 0, 0],
    ('4', '3', 3): [0, 0, 0],
    ('4', '4', 3): [0, 0, 0],

    ('1', '1', 4): [0, 0, 0],
    ('1', '2', 4): [0, 0, 0],
    ('1', '3', 4): [1, 0.4 * 440, 0.5 * 440],
    ('1', '4', 4): [0, 0, 0],

    ('2', '1', 4): [0, 0, 0],
    ('2', '2', 4): [0, 0, 0],
    ('2', '3', 4): [1, 0.4 * 465, 0.5 * 465],
    ('2', '4', 4): [0, 0, 0],

    ('3', '1', 4): [0, 0, 0],
    ('3', '2', 4): [0, 0, 0],
    ('3', '3', 4): [0, 0, 0],
    ('3', '4', 4): [0, 0, 0],

    ('4', '1', 4): [0, 0, 0],
    ('4', '2', 4): [0, 0, 0],
    ('4', '3', 4): [1, 0.4 * 500, 0.5 * 500],
    ('4', '4', 4): [0, 0, 0],

    ('1', '1', 5): [0, 0, 0],
    ('1', '2', 5): [0, 0, 0],
    ('1', '3', 5): [0, 0, 0],
    ('1', '4', 5): [0, 0, 0],

    ('2', '1', 5): [1, 0.4 * 735, 0.5 * 735],
    ('2', '2', 5): [0, 0, 0],
    ('2', '3', 5): [0, 0, 0],
    ('2', '4', 5): [1, 0.4 * 480, 0.5 * 480],

    ('3', '1', 5): [0, 0, 0],
    ('3', '2', 5): [0, 0, 0],
    ('3', '3', 5): [0, 0, 0],
    ('3', '4', 5): [0, 0, 0],

    ('4', '1', 5): [2, 0.4 * 465, 0.5 * 465],
    ('4', '2', 5): [0, 0, 0],
    ('4', '3', 5): [0, 0, 0],
    ('4', '4', 5): [0, 0, 0],

    ('1', '1', 6): [0, 0, 0],
    ('1', '2', 6): [0, 0, 0],
    ('1', '3', 6): [0, 0, 0],
    ('1', '4', 6): [0, 0, 0],

    ('2', '1', 6): [1, 0.4 * 735, 0.5 * 735],
    ('2', '2', 6): [0, 0, 0],
    ('2', '3', 6): [0, 0, 0],
    ('2', '4', 6): [0, 0, 0],

    ('3', '1', 6): [0, 0, 0],
    ('3', '2', 6): [0, 0, 0],
    ('3', '3', 6): [0, 0, 0],
    ('3', '4', 6): [0, 0, 0],

    ('4', '1', 6): [0, 0, 0],
    ('4', '2', 6): [0, 0, 0],
    ('4', '3', 6): [1, 0.4 * 500, 0.5 * 500],
    ('4', '4', 6): [0, 0, 0]
})

x = m.addVars(link_day, name='x', lb=0, vtype=GRB.CONTINUOUS)

y = m.addVars(link_day, name='y', lb=0, vtype=GRB.CONTINUOUS)

obj = quicksum(p[i, j, t] * x[i, j, t] - c[i, j, t] * y[i, j, t] for i, j, t in link_day)

m.addConstrs((av[i, 1] == quicksum(x[i, j, 1] + y[i, j, 1] for j in Nodes) for i in Nodes), name='conservazione_t1')

m.addConstrs(((av[i, t] + quicksum(
    x[j, i, t - tau] + y[j, i, t - tau] + y[i, i, t - 1] for j in Nodes if j != i)) == quicksum(
    x[i, j, t] + y[i, j, t] for j in Nodes) for i in Nodes for t in [2, 3, 4, 5, 6]), name='conservazione_t2')

m.addConstrs((x[i, j, t] <= demands[i, j, t] for i, j, t in link_day),name='soddisfazione_domanda')

m.setObjective(obj, GRB.MAXIMIZE)
m.optimize()
# for v in m.getVars():
#     print('%s %f' % (v.Varname, v.X))

print('Optimal cost: %f' % m.objVal)
vars = m.getVars()
print(vars[1].Varname, vars[1].X)



m.write('q1.lp')
